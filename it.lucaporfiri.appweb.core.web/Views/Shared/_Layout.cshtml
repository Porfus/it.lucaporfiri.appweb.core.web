<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - it.lucaporfiri.appweb.core.web</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome (Icone) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css">

    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/it.lucaporfiri.appweb.core.web.styles.css" asp-append-version="true" />
	<link rel="stylesheet" href="~/lib/dragula/dragula.min.css" />
    <link rel="stylesheet" href="~/css/main.css" asp-append-version="true" />
	@await RenderSectionAsync("Styles", required: false)
</head>
<body>
    <script>
        (function() {
            // Disabilita transizioni
            document.body.classList.add('no-transitions');

            // --- 1. SIDEBAR (sul body) ---
            try {
                var isCollapsed = localStorage.getItem('sidebar-collapsed') === 'true';
                if (isCollapsed) document.body.classList.add('sidebar-collapsed');
            } catch (e) {}

            // --- 2. TEMA (sull'HTML) ---
            try {
                var savedTheme = localStorage.getItem('theme') || 'light'; // Default light
                document.documentElement.setAttribute('data-theme', savedTheme);
            } catch (e) {}

            // Riabilita transizioni
            window.addEventListener('load', function() {
                setTimeout(() => document.body.classList.remove('no-transitions'), 100);
            });
        })();
    </script>

    <div class="app-container">
        @{
            var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
            var currentAction = ViewContext.RouteData.Values["action"]?.ToString();

            string IsActive(string controller, string action)
            {
                if (string.Equals(currentController, controller, StringComparison.OrdinalIgnoreCase) &&
                string.Equals(currentAction, action, StringComparison.OrdinalIgnoreCase))
                {
                    return "active";
                }
                return "";
            }

            string IsControllerActive(string controller)
            {
                if (string.Equals(currentController, controller, StringComparison.OrdinalIgnoreCase))
                {
                    return "active";
                }
                return "";
            }
        }
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a asp-controller="Home" asp-action="Index" class="sidebar-brand">
                    <div class="brand-icon">
                        <i class="fa-solid fa-dumbbell"></i>
                    </div>
                    <span class="brand-text">Gestore Atleti</span>
                </a>
                <!-- Pulsante per collassare la sidebar (visibile su desktop) -->
                <button class="sidebar-toggler" id="sidebarToggler">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- Menu di Navigazione -->
            <nav class="sidebar-nav">
                <ul class="nav-list">
                    <!-- Esempio di link con icone per la modalità collassata -->
                    <!-- Dashboard -->
                    <li class="nav-item">
                        <a class="nav-link @IsActive("Home", "Index")" asp-controller="Home" asp-action="Index">
                            <i class="fas fa-home nav-icon"></i>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </li>

                    <!-- Bacheca Eventi (NUOVO) -->
                    <li class="nav-item">
                        <a class="nav-link @IsActive("Eventi", "BachecaEventi")" asp-controller="Eventi" asp-action="BachecaEventi">
                            <i class="fas fa-calendar-check nav-icon"></i>
                            <span class="nav-text">Bacheca Eventi</span>
                        </a>
                    </li>

                    <li class="nav-divider"></li> <!-- Separatore -->
                    <!-- Moduli Principali -->
                    <li class="nav-label">Moduli</li>

                    <li class="nav-item">
                        <a class="nav-link @IsControllerActive("Atleta")" asp-controller="Atleta" asp-action="Index">
                            <i class="fas fa-users nav-icon"></i>
                            <span class="nav-text">Atleti</span>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link @IsControllerActive("Abbonamento")" asp-controller="Abbonamento" asp-action="Index">
                            <i class="fas fa-receipt nav-icon"></i>
                            <span class="nav-text">Abbonamenti</span>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link @IsControllerActive("Scheda")" asp-controller="Scheda" asp-action="Index">
                            <i class="fa-solid fa-file-lines nav-icon"></i>
                            <span class="nav-text">Schede</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Footer della Sidebar (es. Logout o Settings) -->
            <div class="sidebar-footer">
                <a href="/Home/Login" class="nav-link user-profile">
                    <i class="fa-solid fa-user nav-icon"></i>
                    <span class="nav-text">Profilo</span>
                </a>
            </div>
        </aside>
        <!-- 3. MAIN CONTENT AREA -->
        <!-- Questa parte sta a destra della sidebar -->
        <div class="main-wrapper">

            <!-- Topbar (Header superiore per mobile toggle e theme switcher) -->
            <header class="topbar">
                <!-- Pulsante Hamburger (visibile solo su mobile) -->
                <button class="mobile-toggle" id="mobileToggle">
                    <i class="fas fa-bars"></i>
                </button>

                <!-- Azioni a destra (Theme Switcher, etc.) -->
                <div class="topbar-actions">
                    <button class="theme-switcher" id="theme-switcher" aria-label="Cambia tema">
                        <i class="fas fa-moon"></i>
                        <i class="fas fa-sun"></i>
                    </button>
                </div>
            </header>

            <!-- Contenuto della Pagina (Quello che avevi nel <main>) -->
            <main class="content-area">
                @RenderBody()
            </main>

            <!-- Footer (opzionale, ora sta dentro il main wrapper) -->
            <footer class="content-footer">
                <div class="footer-copyright">
					© @DateTime.Now.Year - Gestore Atleti - Porfus
                </div>
                <div class="footer-links">
                    <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy Policy</a>
                </div>
            </footer>
        </div>
    </div>

    <!-- Script essenziali -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
